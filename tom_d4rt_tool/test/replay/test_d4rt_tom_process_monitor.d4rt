# D4rt Test Suite - Tom Process Monitor Classes
# Run with: d4rt test_d4rt_tom_process_monitor.d4rt -test
# Tests tom_process_monitor bridged classes
# NOTE: Uses single-line syntax for D4rt parser compatibility


# =============================================================================
# Test: ProcessConfig (requires id, name, command)
# =============================================================================

var config = ProcessConfig(id: 'proc-001', name: 'test_process', command: 'dart', args: ['run', 'server.dart']);
verifyNotNull(config, 'ProcessConfig created');
verifyEquals(config.id, 'proc-001', 'Config id');
verifyEquals(config.name, 'test_process', 'Config name');
verifyEquals(config.command, 'dart', 'Config command');
verifyEquals(config.args.length, 2, 'Config args count');
verifyEquals(config.autostart, true, 'Config autostart default');

var config2 = ProcessConfig(id: 'proc-002', name: 'bg_task', command: 'node', workingDirectory: '/app');
verifyEquals(config2.workingDirectory, '/app', 'Config workingDirectory');

# =============================================================================
# Test: ProcessEntry (requires id, name, command, registeredAt)
# =============================================================================

var entry = ProcessEntry(id: 'entry-001', name: 'web_server', command: 'dart', registeredAt: DateTime.now());
verifyNotNull(entry, 'ProcessEntry created');
verifyEquals(entry.id, 'entry-001', 'Entry id');
verifyEquals(entry.name, 'web_server', 'Entry name');
verifyEquals(entry.command, 'dart', 'Entry command');
verifyEquals(entry.state, ProcessState.stopped, 'Entry default state');
verifyEquals(entry.enabled, true, 'Entry enabled default');
verifyEquals(entry.autostart, true, 'Entry autostart default');

# =============================================================================
# Test: ProcessState Enum
# =============================================================================

verifyNotNull(ProcessState.running, 'ProcessState.running');
verifyNotNull(ProcessState.stopped, 'ProcessState.stopped');
verifyNotNull(ProcessState.failed, 'ProcessState.failed');
verifyNotNull(ProcessState.starting, 'ProcessState.starting');
verifyNotNull(ProcessState.stopping, 'ProcessState.stopping');

# =============================================================================
# Test: RestartPolicy (all optional with defaults)
# =============================================================================

var policy = RestartPolicy();
verifyNotNull(policy, 'RestartPolicy created with defaults');
verifyEquals(policy.maxAttempts, 5, 'Policy default maxAttempts');
verifyNotNull(policy.backoffIntervalsMs, 'Policy backoffIntervalsMs');
verifyEquals(policy.retryIndefinitely, false, 'Policy default retryIndefinitely');

verifyNotNull(RestartPolicy.defaultPolicy, 'RestartPolicy.defaultPolicy');

var customPolicy = RestartPolicy(maxAttempts: 10, retryIndefinitely: true);
verifyEquals(customPolicy.maxAttempts, 10, 'Custom policy maxAttempts');
verifyEquals(customPolicy.retryIndefinitely, true, 'Custom policy retryIndefinitely');

# =============================================================================
# Test: AlivenessCheck (requires enabled and url)
# =============================================================================

var aliveCheck = AlivenessCheck(enabled: true, url: 'http://localhost:8080/health');
verifyNotNull(aliveCheck, 'AlivenessCheck created');
verifyEquals(aliveCheck.enabled, true, 'AlivenessCheck enabled');
verifyEquals(aliveCheck.url, 'http://localhost:8080/health', 'AlivenessCheck url');
verifyEquals(aliveCheck.intervalMs, 3000, 'AlivenessCheck default intervalMs');
verifyEquals(aliveCheck.timeoutMs, 2000, 'AlivenessCheck default timeoutMs');
verifyEquals(aliveCheck.consecutiveFailuresRequired, 2, 'AlivenessCheck default failures');

var disabledCheck = AlivenessCheck(enabled: false, url: '');
verifyEquals(disabledCheck.enabled, false, 'Disabled AlivenessCheck');

# =============================================================================
# Test: StartupCheck
# =============================================================================

var startupCheck = StartupCheck(maxAttempts: 50, initialDelayMs: 5000);
verifyNotNull(startupCheck, 'StartupCheck created');
verifyEquals(startupCheck.maxAttempts, 50, 'StartupCheck maxAttempts');
verifyEquals(startupCheck.initialDelayMs, 5000, 'StartupCheck initialDelayMs');

# =============================================================================
# Test: Exception Classes
# =============================================================================

var pmEx = ProcessMonitorException('Process monitor error');
verifyNotNull(pmEx, 'ProcessMonitorException created');
verifyEquals(pmEx.message, 'Process monitor error', 'Exception message');

var lockEx = LockTimeoutException('Lock acquisition timed out');
verifyNotNull(lockEx, 'LockTimeoutException created');

var notFoundEx = ProcessNotFoundException('Process not found');
verifyNotNull(notFoundEx, 'ProcessNotFoundException created');

var disabledEx = ProcessDisabledException('Process is disabled');
verifyNotNull(disabledEx, 'ProcessDisabledException created');

var permEx = PermissionDeniedException('Permission denied');
verifyNotNull(permEx, 'PermissionDeniedException created');

# =============================================================================
# Summary
# =============================================================================

testSummary();
