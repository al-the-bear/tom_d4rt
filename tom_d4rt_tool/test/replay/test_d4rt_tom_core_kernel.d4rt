# D4rt Test Suite - Tom Core Kernel Classes
# Run with: d4rt test_d4rt_tom_core_kernel.d4rt -test
# Tests tom_core_kernel bridged classes


# =============================================================================
# Test: TomException (15 tests)
# =============================================================================

var ex1 = TomException('TEST_KEY', 'Test error message');
verifyNotNull(ex1, 'TomException created');
verifyEquals(ex1.key, 'TEST_KEY', 'Exception key');
verifyEquals(ex1.defaultUserMessage, 'Test error message', 'Exception message');
verifyNotNull(ex1.uuid, 'Exception has uuid');
verifyNotNull(ex1.timeStamp, 'Exception has timestamp');
verifyNotNull(ex1.toString(), 'Exception toString');
verifyContains(ex1.toString(), 'TEST_KEY', 'toString contains key');

var ex2 = TomException('ERR_002', 'Another error', requestUuid: 'req-123');
verifyEquals(ex2.requestUuid, 'req-123', 'Exception requestUuid');

var ex3 = TomException('ERR_003', 'Params error', parameters: {'code': 500});
verifyNotNull(ex3.parameters, 'Exception parameters');
verifyEquals(ex3.parameters['code'], 500, 'Exception parameters value');

# Test autoLog default
var ex4 = TomException('ERR_004', 'AutoLog test');
verifyEquals(ex4.autoLog, false, 'AutoLog default is false');

# Test stackTrace
verifyNotNull(ex1.stackTrace, 'Exception has stackTrace');

# =============================================================================
# Test: TomServerCallError (10 tests)
# =============================================================================

var error = TomServerCallError(statusCode: 404);
verifyNotNull(error, 'TomServerCallError created');
verifyEquals(error.statusCode, 404, 'Error statusCode');
verifyEquals(error.hasError, true, 'Error hasError for 404');

var error2 = TomServerCallError(statusCode: 500, internalError: 1);
verifyEquals(error2.internalError, 1, 'Error internalError');
verifyEquals(error2.hasError, true, 'Error hasError for 500');

var okError = TomServerCallError(statusCode: 200);
verifyEquals(okError.hasError, false, 'No error for 200');

# =============================================================================
# Test: TomMimeType (12 tests)
# =============================================================================

var jsonMime = TomMimeType.json;
verifyNotNull(jsonMime, 'TomMimeType.json exists');
verifyEquals(jsonMime.primaryType, 'application', 'JSON primary type');
verifyEquals(jsonMime.subType, 'json', 'JSON sub type');
verifyContains(jsonMime.toString(), 'json', 'JSON toString');

var textMime = TomMimeType.plainText;
verifyNotNull(textMime, 'TomMimeType.plainText exists');
verifyEquals(textMime.primaryType, 'text', 'Text primary type');
verifyEquals(textMime.subType, 'plain', 'Text sub type');

var htmlMime = TomMimeType.html;
verifyNotNull(htmlMime, 'TomMimeType.html exists');
verifyEquals(htmlMime.primaryType, 'text', 'HTML primary type');
verifyEquals(htmlMime.subType, 'html', 'HTML sub type');

var octetMime = TomMimeType.octetStream;
verifyNotNull(octetMime, 'TomMimeType.octetStream exists');

# =============================================================================
# Test: TomHttpMethod (10 tests)
# =============================================================================

var getMethod = TomHttpMethod.get;
verifyNotNull(getMethod, 'TomHttpMethod.get exists');
verifyEquals(getMethod.name, 'GET', 'GET method name');

var postMethod = TomHttpMethod.post;
verifyNotNull(postMethod, 'TomHttpMethod.post exists');
verifyEquals(postMethod.name, 'POST', 'POST method name');

var putMethod = TomHttpMethod.put;
verifyNotNull(putMethod, 'TomHttpMethod.put exists');

var deleteMethod = TomHttpMethod.delete;
verifyNotNull(deleteMethod, 'TomHttpMethod.delete exists');

var patchMethod = TomHttpMethod.patch;
verifyNotNull(patchMethod, 'TomHttpMethod.patch exists');

# =============================================================================
# Test: Custom TomMimeType (6 tests)
# =============================================================================

var customMime = TomMimeType('image', 'png');
verifyNotNull(customMime, 'Custom TomMimeType created');
verifyEquals(customMime.primaryType, 'image', 'Custom primary type');
verifyEquals(customMime.subType, 'png', 'Custom sub type');

# =============================================================================
# Test: TomBeanLocatorException (4 tests)
# =============================================================================

var beanEx = TomBeanLocatorException('BEAN_NOT_FOUND', 'Bean not found');
verifyNotNull(beanEx, 'TomBeanLocatorException created');
verifyEquals(beanEx.key, 'BEAN_NOT_FOUND', 'BeanException key');
verifyEquals(beanEx.defaultUserMessage, 'Bean not found', 'BeanException message');

# =============================================================================
# Test: TomServerConnectionException (4 tests)
# =============================================================================

var connEx = TomServerConnectionException('CONN_FAILED', 'Connection failed');
verifyNotNull(connEx, 'TomServerConnectionException created');
verifyEquals(connEx.key, 'CONN_FAILED', 'ConnException key');
verifyEquals(connEx.defaultUserMessage, 'Connection failed', 'ConnException message');

# =============================================================================
# Test: TomRequestAbortedException (4 tests)
# =============================================================================

var abortEx = TomRequestAbortedException('REQ_ABORTED', 'Request was aborted');
verifyNotNull(abortEx, 'TomRequestAbortedException created');
verifyEquals(abortEx.key, 'REQ_ABORTED', 'AbortedException key');

# =============================================================================
# Test: TomContentDisposition Static (2 tests)
# =============================================================================

var dispAttach = TomContentDisposition.attachment;
verifyNotNull(dispAttach, 'TomContentDisposition.attachment exists');
verifyEquals(dispAttach, 'attachment', 'Attachment value');

# =============================================================================
# Summary
# =============================================================================

testSummary();
