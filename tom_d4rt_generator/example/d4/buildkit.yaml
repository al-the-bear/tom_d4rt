# Tom Build Configuration for d4_example
# This tests bridge generation for extensions on core types (String, Platform, etc.)
# Also includes DCli bridges for running d4_test_scripts

versioner:
  variable-prefix: d4

d4rtgen:
  name: d4_example
  helpersImport: package:tom_d4rt/tom_d4rt.dart
  generateBarrel: true
  barrelPath: lib/d4rt_bridges.b.dart
  generateDartscript: true
  dartscriptPath: lib/dartscript.b.dart
  registrationClass: D4ExampleBridges
  generateTestRunner: true
  testRunnerPath: bin/d4rtrun.b.dart
  modules:
    - name: core_extensions
      barrelFiles:
        - lib/test_extensions.dart
      barrelImport: package:d4_example/test_extensions.dart
      outputPath: lib/src/d4rt_bridges/core_extensions.b.dart
    - name: path
      barrelFiles:
        - package:path/path.dart
      barrelImport: package:path/path.dart
      outputPath: lib/src/d4rt_bridges/path_bridges.b.dart
    - name: dcli
      barrelFiles:
        - package:dcli/dcli.dart
        - package:dcli_core/dcli_core.dart
      barrelImport: package:dcli/dcli.dart
      outputPath: lib/src/d4rt_bridges/dcli_bridges.b.dart
      followAllReExports: true
      skipReExports:
        - crypto
      excludePatterns:
        - "**/*_bridge.dart"
        - "**/*_generated.dart"
      excludeSourcePatterns:
        # Column class uses ColumnComparator which is not exported from barrel
        - "package:dcli/src/util/file_sort.dart#Column"
        # Extensions on types not exported from barrel (Platform is from dart:io, Digest from crypto)
        - "package:dcli_core/src/util/platform.dart#PlatformEx"
        - "package:dcli/src/util/digest_helper.dart#DigestHelper"
        # Settings and utilities  
        - "package:dcli_core/src/settings.dart#Settings"
        - "package:dcli_core/src/util/file.dart#FileNotFoundException,NotAFileException,withOpenFile,symlink,deleteSymlink,resolveSymLink,stat,fileLength,calculateHash"
        - "package:dcli_core/src/util/limited_stream_controller.dart"
        # Internal dcli_core classes not re-exported from dcli barrel
        - "package:dcli_core/src/functions/dcli_function.dart"
        - "package:dcli_core/src/functions/find_async.dart"

compiler:
  compiles:
    - commandline:
        - dart compile exe ${file} -o ${project-root}/bin/${file.name}
      files: bin/d4.dart
      platforms: [darwin-arm64, darwin-x64, linux-x64, linux-arm64]
